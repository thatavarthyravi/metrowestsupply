<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Order Form | Unit Turn Supply</title>
    <!-- Using your existing stylesheet -->
    <link rel="stylesheet" href="newstyles.css">
    <style>
        /* Modern Form Alignment Fixes */
        body { background-color: #f4f7f9; }
        .order-container { 
            max-width: 950px; 
            margin: 20px auto 60px; 
            padding: 40px; 
            background: white; 
            border-radius: 8px; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.1); 
        }

        
        /* Grid System for Fields */
        .form-row { 
            display: flex; 
            gap: 20px; 
            margin-bottom: 20px; 
        }
        .form-group { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
        }
        .form-group label { 
            font-weight: bold; 
            margin-bottom: 8px; 
            color: var(--navy); 
            font-size: 0.9rem;
        }
        .form-group input, .form-group textarea { 
            padding: 12px; 
            border: 1px solid #ccc; 
            border-radius: 5px; 
            font-size: 1rem; 
            font-family: inherit;
        }

        /* Section Styling */
        .order-section { margin-bottom: 40px; }
        .section-title { 
            background: var(--navy); 
            color: white; 
            padding: 12px 20px; 
            border-radius: 6px 6px 0 0; 
            margin: 0; 
            font-size: 1.1rem; 
        }
        .selection-area { 
            border: 1px solid #ddd; 
            border-radius: 0 0 6px 6px; 
            padding: 20px; 
            background: #fdfdfd; 
        }

        /* Item Rows */
        .item-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: white; 
            padding: 12px 18px; 
            border: 1px solid #eee; 
            border-radius: 6px; 
            margin-bottom: 8px;
        }
        .qty-input { width: 60px; text-align: center; font-weight: bold; margin-right: 10px; }

        /* Cart Summary */
        #cart-container { 
            margin: 30px 0; 
            padding: 20px; 
            background: #fffdfa; 
            border: 2px solid var(--orange); 
            border-radius: 6px; 
        }
        .cart-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 8px 0; 
            border-bottom: 1px solid #eee; 
        }

        @media (max-width: 768px) {
            .form-row { flex-direction: column; gap: 15px; }
            .item-row { flex-direction: column; text-align: center; gap: 10px; }
        }
    </style>
</head>
<body>

    <!-- SITE HEADER -->
    <header>
        <div class="header-left">
            <img src="logo.png" alt="UT Logo" class="logo-small">
            <span>Unit Turn Supply</span>
        </div>
        <nav>
            <a href="index.html">Home</a>
            <a href="bundles.html">Bundles</a>
            <a href="productdetails4.html">Catalog</a>
        </nav>
    </header>

    <div class="order-container">
        <div class="form-header" id="form-header" style="text-align: center; margin-bottom: 40px;">
            <h1 style="color: var(--navy);">Submit Order Request</h1>
            <p>Combine full kits or individual smaller kits for a perfect turn.</p>
        </div>

        <form id="orderForm" action="https://formspree.io/f/xlggeeog" method="POST">
            
            <!-- OPTION A: KITS -->
            <div class="order-section">
                <h2 class="section-title">Choose Full Kits</h2>
                <div class="selection-area" id="full-kits-container">
                    <p style="text-align: center;">Syncing kit data...</p>
                </div>
            </div>

            <!-- OPTION B: MODULES -->
            <div class="order-section">
                <h2 class="section-title" style="background: #555;">Choose Individual Smaller Kits</h2>
                <div class="selection-area" id="modules-container">
                    <p style="text-align: center;">Syncing module data...</p>
                </div>
            </div>

            <!-- DYNAMIC SUMMARY -->
            <div id="cart-container" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <label style="font-weight: bold; font-size: 1.1rem; color: var(--navy);">Your Order Summary</label>
                    <span id="total-badge" style="background: var(--orange); color:white; padding: 4px 12px; border-radius: 20px;">0 Items</span>
                </div>
                <ul id="cart-list" style="list-style: none; padding: 0;"></ul>
                <input type="hidden" name="ORDER_MANIFEST" id="final-order-input" required>
            </div>

            <!-- ALIGNED CONTACT FIELDS -->
            <div class="form-row">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" name="name" required placeholder="John Smith">
                </div>
                <div class="form-group">
                    <label>Company / Property</label>
                    <input type="text" name="company" required placeholder="Unit Turn Mgmt">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" name="_replyto" required placeholder="billing@email.com">
                </div>
                <div class="form-group">
                    <label>Jobsite Delivery Address</label>
                    <input type="text" name="address" required placeholder="123 Main St, Unit 4B">
                </div>
            </div>

            <div class="form-group">
                <label>Special Instructions / Notes</label>
                <textarea name="notes" rows="3" placeholder="Gate codes, preferred delivery time, or custom items..."></textarea>
            </div>

            <button type="submit" id="submit-btn" class="btn-orange" style="width: 100%; font-size: 1.2rem; padding: 18px; margin-top: 20px;">Confirm & Submit Order</button>
        </form>

        <div id="success-message" style="display: none; text-align: center;">
            <div style="font-size: 4rem;">âœ…</div>
            <h2>Order Request Sent</h2>
            <p>We've received your manifest. A specialist will email your invoice and delivery window shortly.</p>
            <a href="index.html" class="btn-orange" style="text-decoration: none; display: inline-block; margin-top: 20px;">Back to Homepage</a>
        </div>
    </div>

    <!-- SITE FOOTER -->
    <footer>
    <div class="container" style="background: none; box-shadow: none; text-align: center; color: white;">
            <p>&copy; 2025 Unit Turn Supply. All rights reserved.</p>
            <nav style="justify-content: center; display: flex; gap: 20px; margin-top: 10px;">
                <a href="index.html" style="color: white;">Home</a>
                <a href="faq.html" style="color: white;">FAQ</a>
                <a href="privacy.html" style="color: white;">Privacy Policy</a>
            </nav>
        </div>
</footer>



   <script>
    const fullKitsContainer = document.getElementById('full-kits-container');
    const modulesContainer = document.getElementById('modules-container');
    const cartList = document.getElementById('cart-list');
    const cartContainer = document.getElementById('cart-container');
    const finalInput = document.getElementById('final-order-input');
    const totalBadge = document.getElementById('total-badge');
    const form = document.getElementById('orderForm');

    let cart = {};

    Promise.all([
        fetch('data/products.json').then(res => res.json()).catch(() => []),
        fetch('data/miniproductbundles.json').then(res => res.json()).catch(() => ({ bundles: [] }))
    ]).then(([productsData, miniData]) => {
        
        // 1. Render Full Kits
        fullKitsContainer.innerHTML = '';
        productsData.forEach(kit => {
            createItemRow(fullKitsContainer, kit.name, "Full Kit");
        });

        // 2. Render Sub-Modules (Categories)
        modulesContainer.innerHTML = '';
        miniData.bundles.forEach(bundle => {
            // Add a Header for each Bundle group
            const groupHeader = document.createElement('h4');
            groupHeader.style = "margin: 20px 0 10px; color: #555; border-bottom: 1px solid #eee; padding-bottom: 5px;";
            groupHeader.innerText = bundle.name;
            modulesContainer.appendChild(groupHeader);

            bundle.categories.forEach(cat => {
                // FIX: Use cat.category because that is the key in your JSON
                createItemRow(modulesContainer, cat.category, "Module");
            });
        });
    });

    function createItemRow(container, displayName, type) {
        const div = document.createElement('div');
        div.className = 'item-row';
        div.innerHTML = `
            <span style="font-weight:500;">${displayName} <small style="color:#888;">(${type})</small></span>
            <div style="display:flex; align-items:center;">
                <input type="number" class="qty-input" min="0" value="0" data-name="${displayName}">
                <span style="font-size: 0.8rem; color: #666;">Qty</span>
            </div>
        `;
        container.appendChild(div);

        div.querySelector('input').addEventListener('input', (e) => {
            const qty = parseInt(e.target.value);
            if (qty > 0) { cart[displayName] = qty; } 
            else { delete cart[displayName]; }
            updateCartUI();
        });
    }

    function updateCartUI() {
        cartList.innerHTML = '';
        let totalItems = 0;
        let manifest = [];

        Object.keys(cart).forEach(name => {
            const qty = cart[name];
            totalItems += qty;
            manifest.push(`${name} (x${qty})`);
            
            const li = document.createElement('li');
            li.className = 'cart-item';
            li.innerHTML = `<span>${name}</span> <strong>x${qty}</strong>`;
            cartList.appendChild(li);
        });

        cartContainer.style.display = totalItems > 0 ? 'block' : 'none';
        totalBadge.innerText = `${totalItems} Items`;
        finalInput.value = manifest.join(', '); 
    }
       // 4. Handle Form Submission with AJAX (Prevents Redirect)
form.addEventListener('submit', async (e) => {
    e.preventDefault(); // This is the magic line that stops the redirect

    // Validate that the cart isn't empty
    if (Object.keys(cart).length === 0) {
        alert("Your order is empty. Please add at least one Kit or Module.");
        return;
    }

    const submitBtn = document.getElementById('submit-btn');
    const successMsg = document.getElementById('success-message');
    const orderForm = document.getElementById('orderForm');
    const formHeader = document.getElementById('form-header');

    // UI Feedback: Disable button so they don't click twice
    submitBtn.disabled = true;
    submitBtn.innerText = "Sending Order Details...";

    // Prepare data for Formspree
    const formData = new FormData(orderForm);

    try {
        const response = await fetch(orderForm.action, {
            method: 'POST',
            body: formData,
            headers: { 'Accept': 'application/json' }
        });

        if (response.ok) {
            // Success! Hide the form and show your checkmark div
            orderForm.style.display = 'none';
            if(formHeader) formHeader.style.display = 'none';
            successMsg.style.display = 'block';
            
            // Optional: Smooth scroll to the top to see the success message
            window.scrollTo({ top: 0, behavior: 'smooth' });
        } else {
            // Server error (e.g., Formspree limit reached)
            alert("Oops! There was a problem submitting your order. Please try again.");
            submitBtn.disabled = false;
            submitBtn.innerText = "Confirm & Submit Order";
        }
    } catch (error) {
        // Network error (e.g., no internet)
        alert("Network error. Please check your connection and try again.");
        submitBtn.disabled = false;
        submitBtn.innerText = "Confirm & Submit Order";
    }
});

</script>

</body>
</html>
