<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Order Form | Unit Turn Supply</title>
    <!-- Using your existing stylesheet -->
    <link rel="stylesheet" href="newstyles.css">
    <style>
        /* Modern Form Alignment Fixes */
        body { background-color: #f4f7f9; }
        .order-container { 
            max-width: 950px; 
            margin: 20px auto 60px; 
            padding: 40px; 
            background: white; 
            border-radius: 8px; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.1); 
        }
        
        /* Grid System for Fields */
        .form-row { 
            display: flex; 
            gap: 20px; 
            margin-bottom: 20px; 
        }
        .form-group { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
        }
        .form-group label { 
            font-weight: bold; 
            margin-bottom: 8px; 
            color: var(--navy); 
            font-size: 0.9rem;
        }
        .form-group input, .form-group textarea { 
            padding: 12px; 
            border: 1px solid #ccc; 
            border-radius: 5px; 
            font-size: 1rem; 
            font-family: inherit;
        }

        /* Section Styling */
        .order-section { margin-bottom: 40px; }
        .section-title { 
            background: var(--navy); 
            color: white; 
            padding: 12px 20px; 
            border-radius: 6px 6px 0 0; 
            margin: 0; 
            font-size: 1.1rem; 
        }
        .selection-area { 
            border: 1px solid #ddd; 
            border-radius: 0 0 6px 6px; 
            padding: 20px; 
            background: #fdfdfd; 
        }

        /* Item Rows */
        .item-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: white; 
            padding: 12px 18px; 
            border: 1px solid #eee; 
            border-radius: 6px; 
            margin-bottom: 8px;
        }
        .qty-input { width: 60px; text-align: center; font-weight: bold; margin-right: 10px; }

        /* Cart Summary */
        #cart-container { 
            margin: 30px 0; 
            padding: 20px; 
            background: #fffdfa; 
            border: 2px solid var(--orange); 
            border-radius: 6px; 
        }
        .cart-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 8px 0; 
            border-bottom: 1px solid #eee; 
        }

        @media (max-width: 768px) {
            .form-row { flex-direction: column; gap: 15px; }
            .item-row { flex-direction: column; text-align: center; gap: 10px; }
        }
    </style>
</head>
<body>

    <!-- SITE HEADER -->
    <header>
        <div class="header-left">
            <img src="logo.png" alt="UT Logo" class="logo-small">
            <span>Unit Turn Supply</span>
        </div>
        <nav>
            <a href="index.html">Home</a>
            <a href="catalog.html">Bundles</a>
            <a href="new-bundles.html">Spec Sheets</a>
        </nav>
    </header>

    <div class="order-container">
        <div class="form-header" id="form-header" style="text-align: center; margin-bottom: 40px;">
            <h1 style="color: var(--navy);">Submit Order Request</h1>
            <p>Combine full kits with individual sub-modules for a perfect turn.</p>
        </div>

        <form id="orderForm" action="https://formspree.io/f/xlggeeog" method="POST">
            
            <!-- OPTION A: KITS -->
            <div class="order-section">
                <h2 class="section-title">Step 1: Choose Full Kits</h2>
                <div class="selection-area" id="full-kits-container">
                    <p style="text-align: center;">Syncing kit data...</p>
                </div>
            </div>

            <!-- OPTION B: MODULES -->
            <div class="order-section">
                <h2 class="section-title" style="background: #555;">Step 2: Add Sub-Modules</h2>
                <div class="selection-area" id="modules-container">
                    <p style="text-align: center;">Syncing module data...</p>
                </div>
            </div>

            <!-- DYNAMIC SUMMARY -->
            <div id="cart-container" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <label style="font-weight: bold; font-size: 1.1rem; color: var(--navy);">Your Order Summary</label>
                    <span id="total-badge" style="background: var(--orange); color:white; padding: 4px 12px; border-radius: 20px;">0 Items</span>
                </div>
                <ul id="cart-list" style="list-style: none; padding: 0;"></ul>
                <input type="hidden" name="ORDER_MANIFEST" id="final-order-input" required>
            </div>

            <!-- ALIGNED CONTACT FIELDS -->
            <div class="form-row">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" name="name" required placeholder="John Smith">
                </div>
                <div class="form-group">
                    <label>Company / Property</label>
                    <input type="text" name="company" required placeholder="Unit Turn Mgmt">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" name="_replyto" required placeholder="billing@email.com">
                </div>
                <div class="form-group">
                    <label>Jobsite Delivery Address</label>
                    <input type="text" name="address" required placeholder="123 Main St, Unit 4B">
                </div>
            </div>

            <div class="form-group">
                <label>Special Instructions / Notes</label>
                <textarea name="notes" rows="3" placeholder="Gate codes, preferred delivery time, or custom items..."></textarea>
            </div>

            <button type="submit" id="submit-btn" class="btn-orange" style="width: 100%; font-size: 1.2rem; padding: 18px; margin-top: 20px;">Confirm & Submit Order</button>
        </form>

        <div id="success-message" style="display: none; text-align: center;">
            <div style="font-size: 4rem;">✅</div>
            <h2>Order Request Sent</h2>
            <p>We've received your manifest. A specialist will email your invoice and delivery window shortly.</p>
            <a href="index.html" class="btn-orange" style="text-decoration: none; display: inline-block; margin-top: 20px;">Back to Homepage</a>
        </div>
    </div>

    <!-- SITE FOOTER -->
    <footer>
        <p>&copy; 2025 Unit Turn Supply. All rights reserved.</p>
    </footer>

    <script>
        const fullKitsContainer = document.getElementById('full-kits-container');
        const modulesContainer = document.getElementById('modules-container');
        const cartList = document.getElementById('cart-list');
        const cartContainer = document.getElementById('cart-container');
        const finalInput = document.getElementById('final-order-input');
        const totalBadge = document.getElementById('total-badge');
        const form = document.getElementById('orderForm');

        let cart = [];

        // LOAD DATA
        Promise.all([
            fetch('data/products.json').then(res => res.json()),
            fetch('data/miniproductbundles.json').then(res => res.json())
        ]).then(([productsData, miniData]) => {
            fullKitsContainer.innerHTML = '';
            productsData.forEach((kit) => {
                createItemRow(fullKitsContainer, kit.name, `$${kit.price_usd}`, 'Full Kit');
            });

            modulesContainer.innerHTML = '';
            miniData.bundles.forEach(bundle => {
                bundle.categories.forEach(cat => {
                    const price = cat.items.reduce((s, i) => s + (i.typical_quantity * i.unit_cost_estimate), 0);
                    createItemRow(modulesContainer, cat.category, `$${price.toFixed(2)}`, `from ${bundle.name}`);
                });
            });
        });

        function createItemRow(parent, name, price, subtext) {
            const row = document.createElement('div');
            row.className = 'item-row';
            const safeId = btoa(name).substring(0, 8); // Unique safe ID
            row.innerHTML = `
                <div style="text-align:left;">
                    <strong style="display:block;">${name}</strong>
                    <small style="color: #666;">${price} | ${subtext}</small>
                </div>
                <div style="display:flex; align-items:center;">
                    <input type="number" value="1" min="1" class="qty-input" id="qty-${safeId}">
                    <button type="button" class="btn-orange" style="margin:0; padding: 6px 12px; font-size: 0.8rem;" onclick="addToCart('${name}', '${safeId}')">Add</button>
                </div>
            `;
            parent.appendChild(row);
        }

        window.addToCart = (name, id) => {
            const qty = parseInt(document.getElementById('qty-' + id).value);
            cart.push({ name, qty });
            renderCart();
        };

        function renderCart() {
            cartList.innerHTML = '';
            let total = 0;
            let manifest = "";
            cart.forEach((item, index) => {
                total += item.qty;
                manifest += `${item.qty}x ${item.name} | `;
                const li = document.createElement('li');
                li.className = 'cart-item';
                li.innerHTML = `<span><strong>${item.qty}x</strong> ${item.name}</span>
                                <button type="button" onclick="removeItem(${index})" style="color:red;border:none;background:none;cursor:pointer;">✕</button>`;
                cartList.appendChild(li);
            });
            cartContainer.style.display = cart.length ? 'block' : 'none';
            totalBadge.innerText = `${total} Items`;
            finalInput.value = manifest;
        }

        window.removeItem = (index) => { cart.splice(index, 1); renderCart(); };

        form.addEventListener("submit", function(e) {
            e.preventDefault();
            if (!cart.length) { alert("Please add at least one item."); return; }
            const btn = document.getElementById("submit-btn");
            btn.innerText = "Sending Request...";
            btn.disabled = true;
            fetch(form.action, { method: 'POST', body: new FormData(form), headers: { 'Accept': 'application/json' } })
                .then(res => { if (res.ok) { 
                    form.style.display = "none"; 
                    document.getElementById("form-header").style.display = "none"; 
                    document.getElementById("success-message").style.display = "block"; 
                    window.scrollTo(0,0); 
                } });
        });
    </script>
</body>
</html>
