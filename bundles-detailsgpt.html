<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UT | Bundle Details</title>
  <link rel="stylesheet" href="newstyles.css">

  <style>
    /* Page-specific styles only (palette comes from newstyles.css) */

    .catalog-toolbar { padding: 22px 40px 0; }
    .catalog-toolbar .row {
      display: flex; gap: 14px; flex-wrap: wrap;
      align-items: flex-end; justify-content: space-between;
      margin-top: 14px;
    }
    .field { display: grid; gap: 8px; min-width: 320px; flex: 1; }
    .field label { font-size: 0.85rem; color: #eaf6ff; opacity: 0.95; }
    .field select {
      border-radius: 6px; border: 1px solid rgba(255,255,255,0.25);
      padding: 12px 12px; font-size: 0.95rem; outline: none;
      background: rgba(255,255,255,0.95); color: #123;
    }

    .bundle-meta {
      padding: 0 40px 18px;
      font-size: 0.85rem;
      color: #cceeff;
      display: flex;
      gap: 18px;
      flex-wrap: wrap;
      opacity: 0.95;
    }
    .bundle-meta b { color: #ffffff; }

    .status { padding: 10px 40px 0; font-size: 0.9rem; color: #cceeff; }

    .details-area {
      padding: 24px 40px 30px;
      background: white;
    }

    .bundle-top {
      display: grid;
      gap: 10px;
      margin-bottom: 14px;
    }

    .bundle-name {
      color: var(--navy);
      font-size: 1.25rem;
      margin: 0;
    }

    .bundle-desc {
      margin: 0;
      color: #555;
      font-size: 0.95rem;
      line-height: 1.4;
    }

    .bundle-kpis {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .kpi {
      background: white;
      border: 1px solid #e6e6e6;
      border-radius: 10px;
      padding: 10px 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
      min-width: 160px;
    }

    .kpi .label { font-size: 0.78rem; color: #666; font-weight: 700; }
    .kpi .value { font-size: 1.05rem; color: var(--navy); font-weight: 800; margin-top: 2px; }

    .tags-row {
      display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px;
    }
    .tagchip {
      font-size: 0.75rem;
      color: #ff6600;
      font-weight: 800;
      background: rgba(255,102,0,0.10);
      border: 1px solid rgba(255,102,0,0.25);
      padding: 5px 10px;
      border-radius: 999px;
    }

    .category-header {
      display: flex; align-items: center; justify-content: space-between;
      gap: 10px; margin: 18px 0 10px;
    }
    .category-header h3 { margin: 0; color: var(--navy); font-size: 1.05rem; }
    .pill {
      font-size: 0.75rem; background: var(--light-grey); color: #444;
      padding: 4px 10px; border-radius: 999px; border: 1px solid #e6e6e6;
      white-space: nowrap;
    }

    .rail {
      display: flex; gap: 16px; overflow-x: auto;
      padding: 8px 0 18px; scroll-snap-type: x mandatory;
    }
    .rail::-webkit-scrollbar { height: 10px; }
    .rail::-webkit-scrollbar-thumb {
      background: rgba(26,42,68,0.25);
      border-radius: 999px;
      border: 2px solid rgba(244,244,244,0.9);
    }

    .tile {
      flex: 0 0 300px;
      scroll-snap-align: start;
      border: 1px solid #e5e5e5;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.06);
      background: white;
      display: grid;
      grid-template-rows: 165px auto;
    }

    .tile-media { position: relative; background: var(--light-grey); }
    .tile-media img { width: 100%; height: 100%; object-fit: cover; display: block; }

    .qty-badge {
      position: absolute; top: 10px; left: 10px;
      background: rgba(26,42,68,0.92);
      color: white; padding: 6px 10px;
      font-size: 0.78rem; border-radius: 999px;
    }

    .tile-body { padding: 12px 12px 14px; display: grid; gap: 10px; }
    .tile-title { font-weight: 800; color: var(--navy); line-height: 1.25; font-size: 0.98rem; }

    .kv { display: flex; justify-content: space-between; gap: 10px; font-size: 0.85rem; color: #555; }
    .kv b { color: #111; }

    .chips { display: flex; flex-wrap: wrap; gap: 6px; }
    .chip {
      font-size: 0.72rem; color: #444;
      border: 1px solid #e3e3e3; padding: 4px 8px;
      border-radius: 999px; background: #fff;
    }

    .actions { display: flex; gap: 10px; margin-top: 2px; }

    .btn-link {
      background-color: var(--orange);
      color: var(--white);
      padding: 10px 12px;
      text-decoration: none;
      border-radius: 4px;
      font-weight: bold;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 0.8rem;
      flex: 1;
      border: 0;
      cursor: pointer;
    }
    .btn-link.secondary {
      background: var(--light-grey);
      color: var(--navy);
      border: 1px solid #ddd;
    }

    .error {
      margin: 10px 40px 0;
      padding: 12px 14px;
      border: 1px solid rgba(255,102,0,.35);
      background: rgba(255,102,0,.08);
      border-radius: 8px;
      color: #7a2c00;
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .catalog-toolbar { padding: 18px 20px 0; }
      .bundle-meta { padding: 0 20px 14px; }
      .status { padding: 10px 20px 0; }
      .details-area { padding: 18px 20px 22px; }
      .field { min-width: 240px; }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Header (matches your index) -->
    <header>
      <div class="header-left">
        <img src="logo.png" alt="UT Logo" class="logo-small">
        <span>Unit Turn Supply</span>
      </div>
      <nav class="nav-menu">
        <a href="catalog.html">Catalog</a>
        <a href="bundles.html">Bundles</a>
        <div class="menu-toggle" id="mobile-menu">
          <span></span><span></span><span></span>
        </div>
      </nav>
    </header>

    <!-- Hero (matches your index) -->
    <div class="hero-section">
      <div class="hero-text">
        <h1>Bundle Details <br><span class="orange-text">What’s Included</span></h1>
        <p>Choose a kit and browse included SKUs as tiles. Each tile links to an external product detail page.</p>

        <div class="catalog-toolbar">
          <div class="row">
            <div class="field">
              <label for="bundleSelect">Select Bundle</label>
              <select id="bundleSelect" disabled></select>
            </div>

            <div class="hero-btns" style="margin-top: 0;">
              <a href="order-form.html" class="btn-white-outline">Order Now</a>
              <button class="btn-orange" id="reloadBtn" type="button">Reload JSON</button>
            </div>
          </div>
        </div>

        <div class="bundle-meta" id="bundleMeta"></div>
      </div>
      <img src="logo.png" alt="UT Main Logo" class="main-logo">
    </div>

    <!-- Main content -->
    <div class="feature-grid-section" style="padding: 0; background: white;">
      <div class="status" id="status"></div>
      <div class="details-area" id="content"></div>
    </div>

    <div class="brand-strip">
      <p>Trusted Brands: Benjamin Moore • PPG • Leviton • Lutron • Moen • Delta • 3M • Oatey</p>
    </div>
  </div>

  <footer>
    <a href="privacy.html">Unit Turn Supply</a>
  </footer>

  <script src="menu.js"></script>

  <script>
    // ✅ Root-relative so it works from any page path
    const DATA_URL = "/data/products.json";

    // Map included-line "prefixes" to images and URLs.
    // Matching is done by startsWith() in order.
    const LINE_CATALOG = [
      {
        match: "DAP Alex Plus",
        brand: "DAP",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3b/Caulk_gun.jpg/640px-Caulk_gun.jpg",
        url: "https://www.dap.com/products-projects/product-categories/caulks-sealants/latex-caulk/"
      },
      {
        match: "USG Sheetrock",
        brand: "USG",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Joint_compound.jpg/640px-Joint_compound.jpg",
        url: "https://www.usg.com/content/usgcom/en/products/walls/drywall/joint-compound/lightweight/all-purpose.html"
      },
      {
        match: "Leviton Decora white single-pole switches",
        brand: "Leviton",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/43/Light_switch.jpg/640px-Light_switch.jpg",
        url: "https://leviton.com/products/5603-2w"
      },
      {
        match: "Leviton white duplex receptacles",
        brand: "Leviton",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Electrical_outlet.jpg/640px-Electrical_outlet.jpg",
        url: "https://store.leviton.com/collections/decora-receptacles"
      },
      {
        match: "Leviton Decora white self-test GFCI outlet",
        brand: "Leviton",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/GFCI_outlet.jpg/640px-GFCI_outlet.jpg",
        url: "https://store.leviton.com/collections/gfci-receptacles"
      },
      {
        match: "Leviton Decora white wallplates",
        brand: "Leviton",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/05/Wall_plate.jpg/640px-Wall_plate.jpg",
        url: "https://store.leviton.com/collections/decora-wallplates"
      },
      {
        match: "Philips LED A19",
        brand: "Philips",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6c/LED_bulb.jpg/640px-LED_bulb.jpg",
        url: "https://www.usa.lighting.philips.com/consumer/bulbs/led-bulbs"
      },
      {
        match: "3M Filtrete",
        brand: "Filtrete (3M)",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Air_filter.jpg/640px-Air_filter.jpg",
        url: "https://www.filtrete.com/3M/en_US/filtrete/products/"
      },
      {
        match: "Kidde 10-year sealed smoke alarms",
        brand: "Kidde",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/Smoke_detector.jpg/640px-Smoke_detector.jpg",
        url: "https://www.kidde.com/home-safety/en/us/products/smoke-alarms/"
      },
      {
        match: "First Alert CO",
        brand: "First Alert",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/12/Carbon_monoxide_alarm.jpg/640px-Carbon_monoxide_alarm.jpg",
        url: "https://www.firstalert.com/us/en/products/alarms/carbon-monoxide-alarms/"
      },
      {
        match: "Kwikset Tylo",
        brand: "Kwikset",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/Door_knob.jpg/640px-Door_knob.jpg",
        url: "https://www.kwikset.com/products"
      },
      {
        match: "Moen Adler",
        brand: "Moen",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4c/Bathroom_faucet.jpg/640px-Bathroom_faucet.jpg",
        url: "https://shop.moen.com/collections/bathroom-faucets"
      }
    ];

    const FALLBACK = {
      img: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/640px-No_image_available.svg.png"
    };

    function parseLine(line) {
      // Example: "DAP Alex Plus white caulk (10.1 oz) ×4"
      // Also supports "x4" / "X4"
      const qtyMatch = line.match(/(?:×|x|X)\s*(\d+)\s*$/);
      const qty = qtyMatch ? Number(qtyMatch[1]) : null;
      const title = qtyMatch ? line.replace(qtyMatch[0], "").trim() : line.trim();

      const found = LINE_CATALOG.find(e => title.startsWith(e.match));
      const url = found?.url || ("https://www.google.com/search?q=" + encodeURIComponent(title));
      const img = found?.img || FALLBACK.img;
      const brand = found?.brand || "—";

      return { raw: line, title, qty, brand, url, img };
    }

    function moneyUSD(n) {
      if (typeof n !== "number") return "";
      return new Intl.NumberFormat("en-US", { style: "currency", currency: "USD" }).format(n);
    }

    function safeText(v) { return (v === undefined || v === null) ? "" : String(v); }

    let BUNDLES = [];

    function renderBundle(sku) {
      const content = document.getElementById("content");
      const meta = document.getElementById("bundleMeta");
      const status = document.getElementById("status");

      const bundle = BUNDLES.find(b => b.sku === sku);
      if (!bundle) {
        content.innerHTML = "";
        meta.innerHTML = "";
        status.innerHTML = `<div class="error"><b>Bundle not found</b> — sku: ${safeText(sku)}</div>`;
        return;
      }

      status.textContent = "";

      meta.innerHTML = [
        bundle.brand ? `<span><b>Brand:</b> ${bundle.brand}</span>` : "",
        bundle.supplier_type ? `<span><b>Supplier type:</b> ${bundle.supplier_type}</span>` : "",
        bundle.category ? `<span><b>Category:</b> ${bundle.category}</span>` : ""
      ].filter(Boolean).join("");

      const includes = Array.isArray(bundle.includes) ? bundle.includes : [];
      const items = includes.map(parseLine);

      const tags = Array.isArray(bundle.tags) ? bundle.tags : [];

      content.innerHTML = `
        <div class="bundle-top">
          <h2 class="bundle-name">${safeText(bundle.name)}</h2>
          <p class="bundle-desc">${safeText(bundle.short_desc)}</p>

          <div class="bundle-kpis">
            <div class="kpi">
              <div class="label">Price</div>
              <div class="value">${moneyUSD(bundle.price_usd)} <span style="font-size:.9rem; color:#666; font-weight:700;">/ kit</span></div>
            </div>
            <div class="kpi">
              <div class="label">SKU</div>
              <div class="value">${safeText(bundle.sku)}</div>
            </div>
            <div class="kpi">
              <div class="label">Type</div>
              <div class="value">${safeText(bundle.type || "bundle")}</div>
            </div>
          </div>

          ${tags.length ? `<div class="tags-row">${tags.map(t => `<span class="tagchip">${t}</span>`).join("")}</div>` : ""}
        </div>

        <div class="category-header">
          <h3>Included Items</h3>
          <span class="pill">${items.length} items</span>
        </div>

        <div class="rail" id="itemsRail"></div>
      `;

      const rail = document.getElementById("itemsRail");
      items.forEach(it => {
        const tile = document.createElement("div");
        tile.className = "tile";
        tile.innerHTML = `
          <div class="tile-media">
            <img src="${it.img}" alt="${it.title}" loading="lazy" referrerpolicy="no-referrer" />
            <div class="qty-badge">${it.qty ? `Qty ×${it.qty}` : "Qty —"}</div>
          </div>
          <div class="tile-body">
            <div class="tile-title">${it.title}</div>
            <div class="kv"><span>Brand</span><b>${it.brand}</b></div>
            <div class="kv"><span>Source</span><b>External</b></div>

            <div class="actions">
              <a class="btn-link" href="${it.url}" target="_blank" rel="noopener noreferrer">View product ↗</a>
              <button class="btn-link secondary" type="button" data-copy="${it.url}">Copy link</button>
            </div>
          </div>
        `;
        rail.appendChild(tile);
      });

      // copy buttons
      rail.querySelectorAll("button[data-copy]").forEach(btn => {
        btn.addEventListener("click", async () => {
          const link = btn.getAttribute("data-copy");
          try {
            await navigator.clipboard.writeText(link);
            const prev = btn.textContent;
            btn.textContent = "Copied!";
            setTimeout(() => (btn.textContent = prev), 900);
          } catch {
            window.prompt("Copy this link:", link);
          }
        });
      });
    }

    async function loadData() {
      const status = document.getElementById("status");
      status.textContent = "Loading bundles…";

      try {
        const res = await fetch(DATA_URL, { cache: "no-store" });
        if (!res.ok) throw new Error(`Fetch failed: ${res.status} ${res.statusText}`);

        const json = await res.json();

        if (!Array.isArray(json)) {
          throw new Error("products.json must be a top-level array of bundles.");
        }

        // keep only bundles (type=bundle), but allow missing type
        BUNDLES = json.filter(x => (x && typeof x === "object")).filter(x => !x.type || x.type === "bundle");

        const select = document.getElementById("bundleSelect");
        select.innerHTML = "";

        BUNDLES.forEach(b => {
          const opt = document.createElement("option");
          opt.value = b.sku;
          opt.textContent = `${b.name} (${b.sku})`;
          select.appendChild(opt);
        });

        select.disabled = false;
        select.onchange = (e) => renderBundle(e.target.value);

        status.textContent = "";
        renderBundle(BUNDLES[0]?.sku);
      } catch (err) {
        status.innerHTML = `<div class="error"><b>Could not load:</b> ${DATA_URL}<br/>${String(err)}</div>`;
      }
    }

    document.getElementById("reloadBtn").addEventListener("click", loadData);
    loadData();
  </script>
</body>
</html>
