<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bundle Comparison | Unit Turn Supply</title>
    <link rel="stylesheet" href="newstyles.css">
    <script src="cdnjs.cloudflare.com"></script>
    <style>
        .catalog-controls { background: var(--navy); padding: 20px; text-align: center; border-bottom: 3px solid var(--orange); }
        .catalog-controls select { padding: 10px; border-radius: 5px; font-size: 1rem; width: 300px; }
        .bundle-total-price { font-size: 2.2rem; color: var(--navy); font-weight: bold; margin: 10px 0; border-bottom: 2px solid var(--orange); display: inline-block; }
        .category-group { margin-top: 20px; border-top: 2px solid #eee; padding-top: 10px; }
        .item-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85rem; }
        .item-table th { text-align: left; background: #f8f9fa; padding: 8px; border-bottom: 2px solid #ddd; }
        .item-table td { padding: 8px; border-bottom: 1px solid #eee; }
        .brand-pill { background: #eef2f7; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; margin-right: 4px; display: inline-block; }
    </style>
</head>
<body>

    
    <!-- Standard Header -->
    <header>
        <div class="header-left">
            <img src="logo.png" alt="UT Logo" class="logo-small">
            <span>Unit Turn Supply</span>
        </div>
        <nav>
            <a href="index.html">Home</a>
            <a href="catalog.html">Bundles</a>
            <a href="order-form.html">Order Now</a>
        </nav>
    </header>

    <div class="catalog-controls">
        <label style="color: white; margin-right: 10px; font-weight: bold;">View Type:</label>
        <select id="catalogSwitcher">
            <option value="data/products.json">Quick Kits (Summary View)</option>
            <option value="data/miniproductbundles.json">Detailed Inventory (Deep Dive)</option>
        </select>
    </div>

    <div class="bundle-grid" id="bundleContainer">
        <!-- Bundles injected here -->
    </div>

    <!-- Standard Footer -->
    <footer>
        <div class="container" style="background: none; box-shadow: none; text-align: center; color: white;">
            <p>&copy; 2025 Unit Turn Supply. All rights reserved.</p>
            <nav style="justify-content: center; display: flex; gap: 20px; margin-top: 10px;">
                <a href="index.html" style="color: white;">Home</a>
                <a href="catalog.html" style="color: white;">Bundles</a>
                <a href="privacy.html" style="color: white;">Privacy Policy</a>
            </nav>
        </div>
    </footer>

    <script>
        const switcher = document.getElementById('catalogSwitcher');
        const container = document.getElementById('bundleContainer');

        async function loadCatalog(filePath) {
            container.innerHTML = "<p style='text-align:center;'>Loading Catalog...</p>";
            try {
                const response = await fetch(filePath);
                const data = await response.json();
                if (filePath.includes('miniproductbundles')) {
                    renderDetailedBundles(data.bundles);
                } else {
                    renderSummaryBundles(data);
                }
            } catch (err) {
                container.innerHTML = "<p style='color:red;'>Error loading file.</p>";
            }
        }

        // Detailed View with Total Cost Calculation
        // Detailed View with Category-Level Totals
function renderDetailedBundles(bundles) {
    container.innerHTML = "";
    bundles.forEach((bundle, index) => {
        let bundleGrandTotal = 0;
        const card = document.createElement('div');
        card.className = 'bundle-card';
        card.id = `bundle-${index}`;
        
        let categoriesHtml = bundle.categories.map(cat => {
            let categorySubtotal = 0;
            
            // Build the rows without individual costs
            let rowsHtml = cat.items.map(i => {
                const lineTotal = i.typical_quantity * i.unit_cost_estimate;
                categorySubtotal += lineTotal;
                bundleGrandTotal += lineTotal;
                return `<tr><td>${i.product}</td><td>${i.typical_quantity}</td></tr>`;
            }).join('');

            // Return the category block with the Subtotal in the header
            return `
                <div class="category-group">
                    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--orange); padding-bottom: 5px;">
                        <strong style="color:var(--navy);">${cat.category}</strong>
                        <span style="font-weight: bold; color: var(--orange);">$${categorySubtotal.toFixed(2)}</span>
                    </div>
                    <table class="item-table">
                        <thead><tr><th>Product</th><th>Qty</th></tr></thead>
                        <tbody>${rowsHtml}</tbody>
                    </table>
                </div>`;
        }).join('');

        card.innerHTML = `
            <span class="sku-label">${bundle.bundle_id}</span>
            <h2>${bundle.name}</h2>
            <div class="bundle-total-price">$${bundleGrandTotal.toFixed(2)} <span style="font-size:0.9rem; color:#666;">Est. Bundle Total</span></div>
            <p style="margin-bottom: 20px;"><em>Goal: ${bundle.goal || 'Complete Unit Refresh'}</em></p>
            ${categoriesHtml}
            <div class="card-actions">
                <button class="btn-pdf" onclick="generatePDF(${index})">Save PDF</button>
                <a href="order-form.html" class="btn-orange">Order Now</a>
            </div>
        `;
        container.appendChild(card);
    });
}


        function renderSummaryBundles(bundles) {
            container.innerHTML = "";
            bundles.forEach((bundle, index) => {
                const card = document.createElement('div');
                card.className = 'bundle-card';
                card.id = `bundle-${index}`;
                card.innerHTML = `
                    <span class="sku-label">${bundle.sku}</span>
                    <h2>${bundle.name}</h2>
                    <div class="bundle-total-price">$${bundle.price_usd} <span>/kit</span></div>
                    <ul class="includes-list">${bundle.includes.map(item => `<li>${item}</li>`).join('')}</ul>
                    <div class="card-actions">
                        <button class="btn-pdf" onclick="generatePDF(${index})">Save PDF</button>
                        <a href="order-form.html" class="btn-orange">Order Now</a>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function generatePDF(id) {
            const element = document.getElementById(`bundle-${id}`);
            const opt = { margin: 0.5, filename: 'Unit-Turn-Spec-Sheet.pdf', html2canvas: { scale: 2 }, jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' } };
            html2pdf().set(opt).from(element).save();
        }

        switcher.addEventListener('change', (e) => loadCatalog(e.target.value));
        loadCatalog('data/products.json');
    </script>
</body>
</html>
